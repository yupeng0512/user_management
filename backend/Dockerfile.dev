# 使用官方Node.js运行时作为基础镜像
FROM node:18-alpine

# 设置工作目录并直接设置权限
WORKDIR /app

# 创建非root用户并设置 /app 目录权限
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nodejs -u 1001 -G nodejs && \
    chown nodejs:nodejs /app

# 切换到 nodejs 用户
USER nodejs

# 复制package.json和package-lock.json（如果存在）
COPY --chown=nodejs:nodejs package*.json ./

# 安装应用依赖（包括开发依赖，现在以 nodejs 用户运行）
RUN npm ci

# 暴露端口
EXPOSE 3001

# 定义容器启动时运行的命令（开发模式）
CMD ["npm", "run", "dev"]
